{% extends "base.html" %}

{% block title %}Prescription #{{ prescription.id }} - SKS Medical Center{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="bi bi-file-medical"></i> Prescription #{{ prescription.id }}</h2>
            <p class="text-muted">Prescription Details</p>
        </div>
        <div class="col-md-4 text-end">
            <button onclick="window.print()" class="btn btn-secondary">
                <i class="bi bi-printer"></i> Print
            </a>
            <a href="{{ url_for('prescriptions') }}" class="btn btn-primary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Prescription Information -->
        <div class="col-md-8">
            <!-- Patient Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person"></i> Patient Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Patient Name</label>
                            <p class="fw-bold">
                                <a href="{{ url_for('patient_detail', patient_id=prescription.patient_id) }}">
                                    {{ prescription.patient.full_name }}
                                </a>
                            </p>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="text-muted">Age</label>
                            <p class="fw-bold">{{ prescription.patient.age }} years</p>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="text-muted">Gender</label>
                            <p class="fw-bold">{{ prescription.patient.gender }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Contact</label>
                            <p class="fw-bold">{{ prescription.patient.contact_number }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Blood Group</label>
                            <p class="fw-bold">{{ prescription.patient.blood_group or 'Not specified' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medicine Details -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-capsule"></i> Medicine Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="text-muted">Medicine Name</label>
                            <p class="fw-bold fs-5">
                                <a href="{{ url_for('medicine_detail', medicine_id=prescription.medicine_id) }}">
                                    {{ prescription.medicine.name }}
                                </a>
                            </p>
                        </div>
                        {% if prescription.medicine.generic_name %}
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Generic Name</label>
                            <p>{{ prescription.medicine.generic_name }}</p>
                        </div>
                        {% endif %}
                        {% if prescription.medicine.strength %}
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Strength</label>
                            <p>{{ prescription.medicine.strength }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Prescription Instructions -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> Prescription Instructions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="text-muted">Dosage</label>
                            <p class="fw-bold fs-5">{{ prescription.dosage }}</p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="text-muted">Frequency</label>
                            <p class="fw-bold fs-5">{{ prescription.frequency }}</p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="text-muted">Duration</label>
                            <p class="fw-bold fs-5">{{ prescription.duration }}</p>
                        </div>
                        {% if prescription.diagnosis %}
                        <div class="col-md-12 mb-3">
                            <label class="text-muted">Diagnosis</label>
                            <p class="fw-bold">{{ prescription.diagnosis }}</p>
                        </div>
                        {% endif %}
                        {% if prescription.instructions %}
                        <div class="col-md-12 mb-3">
                            <label class="text-muted">Special Instructions</label>
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i>
                                {{ prescription.instructions }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Doctor Information -->
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-person-badge"></i> Prescribed By</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Doctor Name</label>
                            <p class="fw-bold">{{ prescription.prescribing_doctor.name }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Specialization</label>
                            <p class="fw-bold">{{ prescription.prescribing_doctor.specialization }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Contact</label>
                            <p class="fw-bold">{{ prescription.prescribing_doctor.contact }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted">Email</label>
                            <p class="fw-bold">{{ prescription.prescribing_doctor.email }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Quick Stats -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="bi bi-info-circle"></i> Prescription Info</h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Prescription ID:</span>
                        <span class="badge bg-secondary">{{ prescription.id }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Prescribed Date:</span>
                        <span class="badge bg-info">
                            {{ prescription.prescribed_date.strftime('%Y-%m-%d') if prescription.prescribed_date else 'N/A' }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Status:</span>
                        <span class="badge bg-success">Active</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-warning">
                    <h6 class="mb-0"><i class="bi bi-lightning"></i> Quick Actions</h6>
                </div>
                <div class="card-body d-grid gap-2">
                    <a href="{{ url_for('patient_detail', patient_id=prescription.patient_id) }}"
                       class="btn btn-primary">
                        <i class="bi bi-person"></i> View Patient
                    </a>
                    <a href="{{ url_for('medicine_detail', medicine_id=prescription.medicine_id) }}"
                       class="btn btn-success">
                        <i class="bi bi-capsule"></i> View Medicine
                    </a>
                    <a href="{{ url_for('find_nearest_pharmacies') }}" class="btn btn-info">
                        <i class="bi bi-shop"></i> Find Pharmacy
                    </a>
                    <button onclick="window.print()" class="btn btn-secondary">
                        <i class="bi bi-printer"></i> Print Prescription
                    </button>
                </div>
            </div>

            <!-- Important Notes -->
            <div class="card shadow-sm border-warning">
                <div class="card-header bg-warning">
                    <h6 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Important</h6>
                </div>
                <div class="card-body">
                    <ul class="small mb-0">
                        <li>Take medicine as prescribed</li>
                        <li>Complete the full course</li>
                        <li>Store in a cool, dry place</li>
                        <li>Keep out of reach of children</li>
                        <li>Consult doctor if side effects occur</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_css %}
<style>
@media print {
    .btn, nav, footer, .card-header.bg-warning, .navbar {
        display: none !important;
    }
    .card {
        border: 1px solid #000;
        page-break-inside: avoid;
    }
}
</style>
{% endblock %}

{% endblock %}
